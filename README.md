# **IndustrialChatbot**

## 📌 目次
- [プロジェクト概要](#プロジェクト概要)
- [進行状況](#進行状況)
- [実装結果](#実装結果)
- [トラブルシューティング](#トラブルシューティング)
- [学習内容](#学習内容)
- [感想](#感想)
- [今後の計画](#今後の計画)

---

## 📌 プロジェクト概要

| 項目            | 詳細内容                                                                 |
|-----------------|-----------------------------------------------------------------------|
| **貢献度**       | 100% (単独開発)                                                        |
| **プロジェクト目的** | 労働者が法令・規定を簡単に見つけて問題解決を支援するRAGベースAIチャットボット開発 |
| **実装期間**    | **2025. 4. 13 ~ 2025. 5. 23**                                              |
| **技術スタック**    | Flutter / Dart / Flask / http / Riverpod / sqflite / table_calendar     |
| **核心機能**    | - カスタマイズ法律情報提供（職種別カスタム推薦）<br>- PDF文書からの法律検索<br>- チャットボットによるQ&A<br>- 出席チェック機能（記録保存） |
| **Pain Point**   | - 労働者が法律を簡単に見つけることが困難<br>- 法律検索が複雑で即座の解決が困難 |
| **解決方法**    | - 職種・関心情報に基づく法律推薦<br>- PDF文書検索機能による情報提供<br>- 出席記録をアプリで管理し継続的データ提供 |
| **改善点**    | - チャットボットの自然言語処理（NLP）改善が必要<br>- 音声入力機能追加検討が必要     |

---

## 📌 進行状況

| 日付           | 作業内容                                                                                             |
|----------------|----------------------------------------------------------------------------------------------------|
| **2025. 4.13** | プロジェクト初期化・環境設定、Splash Screen実装                                                      |
| **2025. 4.14** | Onboarding画面でユーザー個人情報入力機能実装                                                  |
| **2025. 4.16** | コードリファクタリング、下部Tab Bar・HomeScreen実装                                                          |
| **2025. 4.17** | ChatScreen実装・チャットボット対話UI改善                                                                    |
| **2025. 4.19** | flutter_riverpod適用、対話UI補修、出席チェック記録保存機能追加                                       |
| **2025. 4.21** | データ保存・管理最適化<br>ContactScreen実装・フィルタリング機能改善<br>出席カレンダー機能向上             |
| **2025. 4.23** | ホーム画面改善：<br> - 今日の法律情報UI改善<br> - 給与計算機UI追加<br> - 労働契約書ガイド詳細ビュー追加 |
| **2025. 5.10** | **RAGベースバックエンド最適化：**<br>- FastAPIサーバー構築・Postmanテスト完了<br>- KOSHA Guide PDF文書抽出・ベクター化<br>- 法条項自動抽出機能実装<br>- TTS改善方案研究 |
| **2025. 5.12** | **Flutter-Python API連携完成：**<br>- FlutterアプリでPython FastAPIサーバーとリアルタイム通信実装<br>- 産業安全衛生関連質問時の正確な回答と参考資料提供<br>- 関連のない質問は適切にフィルタリングして応答<br>- Android Gradle Pluginバージョン互換性問題解決<br>- iOS/Androidプラットフォーム別ネットワーク設定最適化<br>- UTF-8エンコーディング処理でハングル文字化け問題解決 |

---

## 📌 実装結果

### アプリ主要画面

<table>
<tr>
 <td align="center" width="33.33%"><strong>スプラッシュ・ユーザー情報画面</strong><br><img src="https://github.com/user-attachments/assets/763859c5-afa3-4f45-9049-649ce6aa4e71" width="100%"></td>
 <td align="center" width="33.33%"><strong>今日の法令情報・給与計算機</strong><br><img src="https://github.com/user-attachments/assets/42c5796c-ac87-4e60-91cc-25e00bc2107a" width="100%"></td>
 <td align="center" width="33.33%"><strong>クイック移動・労働契約書作成法</strong><br><img src="https://github.com/user-attachments/assets/9d6f75b0-20b6-499f-96e3-fefb10e486eb" width="100%"></td>
</tr>
<tr>
 <td align="center" width="33.33%"><strong>チャットボット画面</strong><br><img src="https://github.com/user-attachments/assets/ca3d6bc9-08d0-4d16-bf1f-3a3db2edc03ef" width="100%"></td>
 <td align="center" width="33.33%"><strong>会社連絡先画面</strong><br><img src="https://github.com/user-attachments/assets/42456086-4f1c-4318-b76d-9c93fcfb58cd" width="100%"></td>
 <td align="center" width="33.33%"></td>
</tr>
</table>

---

## 📌 トラブルシューティング

### 🔹 問題1: Onboarding画面でユーザー情報保存不可
- **原因:** SharedPreferencesの非同期処理問題でデータが即座に反映されない  
- **解決:** `await`を使用して保存完了後に画面遷移処理

### 🔹 問題2: チャットボットメッセージ間の間隔不足
- **原因:** 連続メッセージ間の区分が困難で可読性低下  
- **解決:** 同じユーザー間10px、異なるユーザー間16px間隔適用でUX改善

### 🔹 問題3: 出席チェック記録保存問題
- **原因:** StateProvider使用時にアプリ再起動時に初期化  
- **解決:** SharedPreferencesでローカルデータ保存により永続性確保

### 🔹 問題4: FastAPIとLangChain互換性問題
- **原因:** LangChainパッケージのバージョン衝突で`_LC_ID_PREFIX`インポートエラー発生
- **解決:** LangChain依存関係を削除しOpenAI APIを直接呼び出す方式でコードリファクタリング

### 🔹 問題5: PDF文書からのテーブルデータ抽出困難
- **原因:** PDF構造が複雑で単純テキスト抽出ではテーブル構造損失
- **解決:** TableFormerモデルとdoclingライブラリを活用してテーブル構造保持しながら抽出

### 🔹 問題6: Android Gradle Pluginバージョン互換性問題
- **原因:** AGP 8.3.0とJava 21間のバージョン衝突、Gradleバージョン不一致
- **解決:** 
- AGPを8.1.4にダウングレード
- Gradleを8.2に設定
- Java 17に変更し安定的なビルド環境構成

### 🔹 問題7: macOSディスク容量不足によるビルド失敗
- **原因:** Xcode DerivedDataとCoreSimulatorキャッシュが大量の容量占有
- **解決:** 
- Xcodeキャッシュ・不要なシミュレーターデータ整理
- Flutterプロジェクトビルドキャッシュ削除
- 10GB以上の空き容量確保

### 🔹 問題8: Flutter-Python API通信時のハングルエンコーディング問題
- **原因:** JSONレスポンスのUTF-8エンコーディングが正しく処理されない
- **解決:** 
- HTTPヘッダーに`charset=utf-8`明示
- `response.bodyBytes`を使用して明示的にUTF-8デコーディング
- Google Fontsを`notoSans`に変更してハングル対応

### 🔹 問題9: iOSネットワークセキュリティポリシーによるAPI呼び出し遮断
- **原因:** iOSのApp Transport Security(ATS)ポリシーによるHTTP通信遮断
- **解決:** 
- Info.plistに`NSAppTransportSecurity`設定追加
- localhostに対する例外処理設定
- 開発環境でのみHTTP通信許可

---

## 📌 学習内容

### ✅ 1. Riverpod状態管理
- `StateNotifierProvider`を利用した構造的状態管理方法学習
- `ConsumerWidget`、`ConsumerStatefulWidget`使用法習得

### ✅ 2. SharedPreferences非同期処理理解
- `set/getStringList()`等メソッド使用法学習
- `await`で保存完了時点を制御する重要性認識

### ✅ 3. ユーザーエクスペリエンス（UX）を考慮したUI改善
- チャットボットメッセージレイアウト整列、間隔調整
- テキストスタイル、簡潔なUI構成で可読性向上

### ✅ 4. 出席カレンダー実装
- `table_calendar`パッケージ活用
- 日付別出席表示、トグルボタンによるUX考慮

### ✅ 5. 今日の労働法ウィジェット・バナー構成
- カード形式の情報要約ウィジェット構成
- 法律情報、契約書ガイド、給与計算等の実用機能強調

### ✅ 6. FastAPIとRAGシステム構築
- PDF文書からのテーブルデータ抽出・自然言語変換技法学習
- 文書チャンキング・エンベディングによるセマンティック検索実装
- Chromaベクターデータベース活用方法習得
- 法条項正規表現抽出・OpenAI API連携

### ✅ 7. クライアント-サーバー通信最適化
- Postmanを活用したAPIテスト方法学習
- JSON形式の要求/応答構造設計
- HTTPステータスコード・エラー処理方法理解
- サーバーデプロイオプション・コスト効率的な運用方案研究

### ✅ 8. 音声インターフェース（TTS）研究
- 様々なTTSライブラリ比較分析 (gTTS、pyttsx3、Naver Clova)
- オフライン/オンラインTTSソリューションの長所短所把握
- 自然な韓国語音声合成のための最適アプローチ模索
- サーバー依存性最小化のためのハイブリッドTTSアーキテクチャ研究

### ✅ 9. Cross-Platform開発環境構築・デバッグ
- Android Gradle PluginとJavaバージョン互換性問題解決経験
- iOS/Androidプラットフォーム別ネットワーク設定の違い理解
- UTF-8エンコーディング・多言語サポートのための設定方法習得
- 開発ツール間依存関係管理・バージョン衝突解決能力向上

### ✅ 10. システムリソース管理・最適化
- macOSシステムキャッシュ管理方法学習
- 開発環境でのディスク容量効率的活用法習得
- 大容量ビルドファイル・キャッシュ整理自動化方案研究

---

## 📌 感想

- 最初は途方に暮れたが、機能を一つ一つ実装しながら構造的に思考する力が身についた  
- 単純に機能を実装するのではなく、**ユーザーの立場で何が有用かを考える経験**が重要  
- 状態管理とデータ保存を構造化することで**コードがはるかに明確で拡張可能になった**  
- 「小さなUI改善一つが全体のUXを大幅に向上させることができる」ということを体感
- APIサーバー構築過程で**各コンポーネントの役割を明確に分離すること**が保守性と拡張性に大きな影響を与えることを悟った
- **パッケージバージョン管理と互換性チェックの重要性**を切実に感じた - 一つのバージョン衝突が全体プロジェクトを麻痺させる可能性がある
- **一つのシステムで複数の開発環境を運用する時のリソース管理**がいかに重要かを経験
- 文字エンコーディングとプラットフォーム別ネットワークポリシーなど**クロスプラットフォーム開発の細かな違い**を理解するようになった

---

## 📌 今後の計画

- **自然言語処理改善:** チャットボット応答精度向上・RAG応答フロー改善  
- **音声入力導入:** Flutter音声認識プラグイン活用で機能実験  
- **私の労働生活分析タブ追加:** 出席率、活動統計、私の質問コレクション等個人化データ提供  
- **契約書自動作成機能追加:** ユーザー情報ベースでPDF労働契約書生成・保存  
- **アプリテスト・デプロイ:** 機能安定化後テスト進行 → ユーザーフィードバックベース改善・デプロイ
- **サーバーデプロイ:** ローカル開発環境からクラウドサーバーへマイグレーション
- **CI/CDパイプライン構築:** 自動化されたビルド・デプロイシステム構築

---
